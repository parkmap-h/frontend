#!/bin/sh

IMAGE="eiel/parkmap"
CMD="bin/rake"
OPTIONS="-it --link my-db:db"
ENVS="CODECLIMATE_REPO_TOKEN"

DEFAULT_ENVS="CIRCLE_ARTIFACTS CIRCLE_BRANCH CIRCLE_BUILD_NUM CIRCLE_COMPARE_URL CIRCLE_NODE_INDEX CIRCLE_NODE_TOTAL CIRCLE_PREVIOUS_BUILD_NUM CIRCLE_PROJECT_REPONAME CIRCLE_PROJECT_USERNAME CIRCLE_SHA1 CIRCLE_TEST_REPORTS CIRCLE_USERNAME CIRCLECI CI"

ENVS="$ENVS $DEFAULT_ENVS"

env_options=""
for env in $ENVS
do
  ENV_OPTIONS="${ENV_OPTIONS} -e ${env}=`printenv $env`"
done

docker run $OPTIONS $ENV_OPTIONS $IMAGE $CMD
